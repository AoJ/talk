<html>
<head>
  <script src="http://underscorejs.org/underscore.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script src="https://raw.github.com/michael/dance/gh-pages/dance.js"></script>
  <script src="/talk.js"></script>

  <script>
    var talk = new Talk.Client("ws://localhost:3100/");

    var operations = {
      "document:create": {
        "command": "document:create",
        "name": "project-1",
        "user": "michael",
        "rev": 4,
        "attributes": {
          "title": "A new title"
        }
      }
    };

    talk.ready(function() {
      console.log('rrrrrready');
      // Create document
      talk.send(operations["document:create"]);
    });

    talk.on('message', function(message) {
      $('#messages').append($('<div>'+message.message+'</div>'));
    });

    $(function() {
      $('#send_message').submit(function(e) {

        var message = {
          "command": "node:insert",
          "type": "/type/task",
          "message": $('#message').val()
        };

        talk.send(message, null, function() {
          console.log('message confirmed');
        });

        return false;
      });
    });
  </script>
</head>
<body>
  <form id="send_message">
    <input type="" id="message"/>
    <input type="submit" value="Send"/>
  </form>

  <div id="messages">

  </div>
</body>
</html>